<html>
	<head>
		<script src="http://code.jquery.com/jquery-latest.js"></script>
		<link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />
		<script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
		<script src="../javascripts/underscore.js"></script>
	  <script src="../javascripts/PieceDrawer.js"></script>
	  <script src="../javascripts/board.js"></script>
	  <script src="../javascripts/collisionDetector.js"></script>
	  <script src="../javascripts/pill.js"></script>
	  <script src="../javascripts/bug.js"></script>
	  <script src="../javascripts/game.js"></script>
	  <script src="../javascripts/main.js"></script>
	</head>
	<body>
		 <h1 id="qunit-header">rr_mojo tests</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
	</body>
	<script>
	function createBoard(){
		width = 10;
		height = 16;
		return new Board(width,height);
	}
	$(function(){
		module("Board");
		test("Board Creation",function(){
			var b = createBoard();
			notEqual(b.board,undefined, "board should be defined");
			equal(b.width,width,"width should match");
			equal(b.height,height,"height should match");
			var empty = true;
			b.eachSpot(function(spot,loc){
				if(!_.isUndefined(spot)){
					empty = false;
				}
			});
			equal(empty,true,"board should be empty");
		});
		test("Board Functions",function(){
			var b = createBoard();
			var in_bounds = true;
			for(var i = 0; i<width; ++i){
				for(var j = 0; j < height; ++j){
					if(in_bounds){
						in_bounds = b.inBounds(i,j);
					}
				}
			}
			equal(in_bounds,true,"board should be inbounds");
			equal(b.inBounds(-1,0),false,"should not be inbounds");
			equal(b.inBounds(width,height),false,"should not be inbounds");
		});
		test("Clear Board",function(){
			var b = createBoard();
			b.board[0][0] = {color : "red"};
			b.board[2][1] = {color : "red"};
			b.board[0][2] = {color : "red"};
			b.board[0][3] = {color : "red"};
			b.board[1][0] = {color : "red"};
			b.board[1][1] = {color : "red"};
			b.board[5][2] = {color : "red"};
			b.board[1][3] = {color : "red"};
			b.board[1][5] = {color : "red"};
			b.board[1][6] = {color : "red"};
			b.board[6][7] = {color : "red"};
			b.board[2][8] = {color : "red"};
			b.clearAll();
			var empty = true;
			b.eachSpot(function(spot){
				if(!_.isUndefined(spot)){
					empty = false;
				}
			});
			equal(true,empty,"Board should be empty");
		})
	module("game");
		test("Match Detection X axis",function(){
			var b = createBoard();
			b.board[0][0] = {color : "red"};
			b.board[1][0] = {color : "red"};
			b.board[2][0] = {color : "red"};
			b.board[3][0] = {color : "red"};
			b.board[2][height - 1] = {color : "blue"};
			b.board[3][height - 1] = {color : "blue"};
			b.board[4][height - 1] = {color : "blue"};
			b.board[5][height - 1] = {color : "blue"};
			b.board[6][height - 1] = {color : "blue"};
			b.board[2][height - 2] = {color : "blue"};
			b.board[3][height - 2] = {color : "blue"};
			b.board[4][height - 2] = {color : "blue"};
			b.board[5][height - 2] = {color : "blue"};
			equal(3,b.matches().length,"Should Find 3 Matches");
		});

		test("Match Detection Y axis",function(){
			var b = createBoard();
			b.board[0][1] = {color : "red"};
			b.board[0][2] = {color : "red"};
			b.board[0][3] = {color : "red"};
			b.board[0][4] = {color : "red"};
			b.board[0][6] = {color : "red"};
			b.board[0][7] = {color : "red"};
			b.board[0][8] = {color : "red"};
			b.board[0][9] = {color : "red"};
			b.board[2][6] = {color : "red"};
			b.board[2][7] = {color : "red"};
			b.board[2][8] = {color : "red"};
			b.board[2][9] = {color : "red"};
			equal(3,b.matches().length,"Should Find 3 Matches");
		});

		test("Match Detection X and Y axis",function(){
			var b = createBoard();
			b.board[0][1] = {color : "red"};
			b.board[0][2] = {color : "red"};
			b.board[0][3] = {color : "red"};
			b.board[0][4] = {color : "red"};
			b.board[1][0] = {color : "teal"};
			b.board[2][0] = {color : "teal"};
			b.board[3][0] = {color : "teal"};
			b.board[4][0] = {color : "teal"};
			b.board[5][15] = {color : "red"};
			b.board[5][14] = {color : "red"};
			b.board[5][13] = {color : "red"};
			b.board[5][12] = {color : "red"};
			b.board[5][11] = {color : "red"};
			b.board[5][10] = {color : "green"};
			b.board[5][9] = {color : "teal"};
			b.board[5][8] = {color : "teal"};
			b.board[5][7] = {color : "teal"};
			equal(3,b.matches().length,"Should Find 3 Matches");
		});

		test("Match Detection Overlapping Matches",function(){
			var b = createBoard();
			b.board[0][1] = {color : "red"};
			b.board[0][2] = {color : "red"};
			b.board[0][3] = {color : "red"};
			b.board[0][4] = {color : "red"};
			b.board[1][1] = {color : "red"};
			b.board[2][1] = {color : "red"};
			b.board[3][1] = {color : "red"};
			equal(2,b.matches().length,"Should Find 2 Matches");
		});

		test("Dangling Pieces",function(){
			var b = createBoard();
			b.board[0][1] = {color : "red", connected : {x : 1, y: 1}};
			b.board[1][1] = {color : "red", connected : {x : 0, y: 1}};
			b.board[1][2] = {color : "teal"};

			b.board[3][12] = {color : "green", connected : {x : 3, y: 13}};
			b.board[3][13] = {color : "red", connected : {x : 3, y: 12}};

			b.board[5][12] = {color : "red", connected : {x : 6, y: 12}};
			b.board[6][12] = {color : "teal", connected : {x : 5, y: 12}};

			b.board[0][b.height -1] = {color : "red"};
			equal(b.dangling().length, 4, "Should Find 4 Dangling Piece(s)")
		});
	})
	</script>
</html>