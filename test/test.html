<html>
	<head>
		<script src="http://code.jquery.com/jquery-latest.js"></script>
		<link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />
		<script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
		<script src="../javascripts/underscore.js"></script>
	  <script src="../javascripts/PieceDrawer.js"></script>
	  <script src="../javascripts/board.js"></script>
	  <script src="../javascripts/collisionDetector.js"></script>
	  <script src="../javascripts/pill.js"></script>
	  <script src="../javascripts/bug.js"></script>
	  <script src="../javascripts/game.js"></script>
	  <script src="../javascripts/main.js"></script>
	</head>
	<body>
		 <h1 id="qunit-header">rr_mojo tests</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
	</body>
	<script>
	function createBoard(){
		width = 10;
		height = 16;
		return new Board(width,height);
	}

	function newPill(b,pos,colors){
		var c = new CollisionDetector(b);
		return 	new Pill(b, c, pos, colors);
	}

	$(function(){
		module("Board");
		test("Board Creation",function(){
			var b = createBoard();
			notEqual(b.board,undefined, "board should be defined");
			equal(b.width,width,"width should match");
			equal(b.height,height,"height should match");
			var empty = true;
			b.eachSpot(function(spot,loc){
				if(!_.isUndefined(spot)){
					empty = false;
				}
			});
			equal(empty,true,"board should be empty");
		});
		test("Board Functions",function(){
			var b = createBoard();
			var in_bounds = true;
			for(var i = 0; i<width; ++i){
				for(var j = 0; j < height; ++j){
					if(in_bounds){
						in_bounds = b.inBounds(i,j);
					}
				}
			}
			equal(in_bounds,true,"board should be inbounds");
			equal(b.inBounds(-1,0),false,"should not be inbounds");
			equal(b.inBounds(width,height),false,"should not be inbounds");
		});
		test("Clear Board",function(){
			var b = createBoard();
			var position = [ {x : 0 , y : 0 }, {x : 2, y : 1 } ];
			var colors = ["red", "red"];
			newPill(b,position,colors);
			b.clearAll();
			var empty = true;
			b.eachSpot(function(spot){
				if(!_.isUndefined(spot)){
					empty = false;
				}
			});
			equal(true,empty,"Board should be empty");
		})
	module("Pill");
		test("Create a Pill", function(){
			var b = createBoard();
			var c = new CollisionDetector(b);
			var position = [ {x : 0 , y : 0 }, {x : 1 , y : 0 } ];
			var colors = ["red", "blue"];
			var p = new Pill(b, c, position, colors);
			expect(0);
		});
		test("Pill detects a collision", function(){
			var b = createBoard();
			var c = new CollisionDetector(b);
			var position2 = [ {x : 0 , y : 1 }, {x : 1 , y : 1 } ];
			var position = [ {x : 0 , y : 0 }, {x : 1 , y : 0 } ];
			var colors = ["red", "blue"];
			var p = new Pill(b, c, position, colors);
			var p2 = new Pill(b, c, position2, colors);
			equal(false, p.moveDown(), "Piece Should Not be able to move down");
		})
	module("game");
		test("Match Detection X axis",function(){
			var b = createBoard();
			newPill(b,[ {x : 0 , y : 0 }, {x : 1, y : 0 } ],["red", "red"]);
			newPill(b,[ {x : 2 , y : 0 }, {x : 3, y : 0 } ],["red", "red"]);
			equal(b.matches().length,1,"Should Find 1 Match");
		});

		test("Match Detection Y axis",function(){
			var b = createBoard();
			newPill(b,[ {x : 0 , y : 0 }, {x : 0, y : 1 } ],["red", "red"]);
			newPill(b,[ {x : 0 , y : 2 }, {x : 0, y : 3 } ],["red", "red"]);

			equal(b.matches().length,1,"Should Find 1 Matches");
		});

		test("Match Detection X and Y axis",function(){
			var b = createBoard();
			newPill(b,[ {x : 0 , y : 0 }, {x : 1, y : 0 } ],["red", "red"]);
			newPill(b,[ {x : 2 , y : 0 }, {x : 3, y : 0 } ],["red", "red"]);

			newPill(b,[ {x : 5 , y : 0 }, {x : 5, y : 1 } ],["red", "red"]);
			newPill(b,[ {x : 5 , y : 2 }, {x : 5, y : 3 } ],["red", "red"]);
			equal(b.matches().length,2,"Should Find 2 Matches");
		});

		test("Match Detection Overlapping Matches",function(){
			var b = createBoard();
			newPill(b,[ {x : 0 , y : 0 }, {x : 1, y : 0 } ],["red", "red"]);
			newPill(b,[ {x : 2 , y : 0 }, {x : 3, y : 0 } ],["red", "red"]);
			newPill(b,[ {x : 1 , y : 1 }, {x : 1, y : 2 } ],["red", "red"]);
			newPill(b,[ {x : 1 , y : 3 }, {x : 1, y : 4 } ],["red", "red"]);
			equal(b.matches().length,2,"Should Find 2 Matches");
		});

		test("Dangling Pieces",function(){
			var b = createBoard();
			b.board[0][1] = {color : "red", connected : {x : 1, y: 1}};
			b.board[1][1] = {color : "red", connected : {x : 0, y: 1}};
			b.board[1][2] = {color : "teal"};

			b.board[3][12] = {color : "green", connected : {x : 3, y: 13}};
			b.board[3][13] = {color : "red", connected : {x : 3, y: 12}};

			b.board[5][12] = {color : "red", connected : {x : 6, y: 12}};
			b.board[6][12] = {color : "teal", connected : {x : 5, y: 12}};

			b.board[0][b.height -1] = {color : "red"};
			equal(b.dangling().length, 4, "Should Find 4 Dangling Piece(s)")
		});
	})
	</script>
</html>